#!/usr/bin/groovy
// Jenkins job: APIServer_Pipeline

import groovy.json.JsonSlurperClassic

repositoryUrl = "https://github.com/buildit/jenkins-pipeline-examples.git"
script = "pipelines/meta-pipeline.groovy"
branch = "development"
def bitbucketCredsId = 'bitbucket-jenkins'

// def label = "jenkins-${UUID.randomUUID().toString()}"
// podTemplate(label: label) {
 //   node(label) {
 //       stage('Git clone') {
 //              sh '''#!/bin/bash
                   
                  // ssh-keyscan bitbucket.org >> ~/.ssh/known_hosts
                  // cd ~
                  //  git clone git@bitbucket.org:michael_murzakhanov/cryptosignaller.git
                  // cd ~/cryptosignaller
                  //  ls -la
//               '''
//        }
//    }
// }


def label = "jenkins-${UUID.randomUUID().toString()}"
 podTemplate(label: label) {
   node(label) {

       def scmVars = checkout([
               $class : 'GitSCM',
               branches : [[name: '*/development']],
               doGenerateSubmoduleConfigurations: false,
               extensions : [/*[$class: 'CleanBeforeCheckout']*/],
               submoduleCfg : [],
               userRemoteConfigs: [[credentialsId: 'bitbucket-jenkins', url: 'https://IlyaRogachov@bitbucket.org/michael_murzakhanov/cryptosignaller.git']]
       ])

       stage('Git clone') {
           stage('test') {
              println 'some text'
              println scmVars.GIT_BRANCH
           }
        }
    }
 }
